#!/bin/sh
#
# Re-create language.h
#

if [ -z "$1" ]; then
	echo "You must specify a language file to convert."
	echo "Syntax: $0 langfile"
	exit 1
elif [ ! -f lang/$1 -a ! -f lang/$1.lng ]; then
	echo "Language file $1 does not exist."
	exit 1
fi


if [ -f include/language.h ]; then
	if [ -f lang/$1 ]; then
		LANG=lang/$1
	else
		LANG=lang/$1.lng
	fi
	DATE=`date`

	cat >include/language.h <<EOF
/*  Magick IRC Services
**
** (c) 1997-2000 Preston Elder <prez@magick.tm>
** (c) 1998-2000 William King <ungod@magick.tm>
**
** The above copywright may not be removed under any
** circumstances, however it may be added to if any
** modifications are made to this file.  All modified
** code must be clearly documented and labelled.
**
** ==========================================================
#pragma ident "\$Id\$"
** ==========================================================
**
** Third Party Changes (please include e-mail address):
**
** N/A
**
** Changes by Magick Development Team <magick-devel@magick.tm>:
**
** \$Log\$
**
** ========================================================== */

#ifndef _LANGUAGE_H
#define _LANGUAGE_H

/* Automatically generated hard-coded language file.
 * Based upon $LANG.
 * Created on $DATE
 */

EOF
	echo "int def_langent = `cat $LANG | wc -l`;" >>include/language.h
	echo "char *def_lang[] = {" >>include/language.h
	sed -e "s/\\\\/\\\\\\\\/g" -e "s/\"/\\\\\"/g" -e "s/^/\"/g" \
		-e "s/$/\",/g" $LANG >>include/language.h
	echo "\"\" };" >>include/language.h
	echo "#endif" >>include/language.h
	
	echo "include/language.h created successfully."
else
	echo "Existing language.h file missing."
	echo "To create one, type: > include/language.h"
	echo "Then re-run this script."
fi
