<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>The Magick Handbook: Usage </TITLE>
 <LINK HREF="index-4.html" REL=next>
 <LINK HREF="index-2.html" REL=previous>
 <LINK HREF="index.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="index-4.html">Next</A>
<A HREF="index-2.html">Previous</A>
<A HREF="index.html#toc3">Contents</A>
<HR>
<H2><A NAME="s3">3. Usage </A></H2>

<P>
<P>
<H2><A NAME="ss3.1">3.1 Support files</A>
</H2>

<P>
<P>All files and directories listed are relative to the current
'Services Directory'. The services directory is set with the
--dir command line option. If none is specified, it will default
to the current directory.
<P>
<DL>
<DT><B>magick.ini</B><DD><P>This file is included with your Magick distribution
in the docs directory.  This file must either be specified on the
command line with the --config option, or in the services directory.
This file contains all settings that Magick II will use throughout
its execution (these can be changed and reloaded online).
<P>
<DT><B>magick.mnd</B><DD><P>This is the Magick New Datafile (or mound) file.  This
stores all data that is stored by Magick.  This file is not human
readable, and is often encrypted and/or compressed.  This filename
is a setting in the magick.ini file, and may be changed.  This file
will be created if it does not exist.
<P>
<DT><B>magick.log</B><DD><P>This is the log file which logs all activity of note
that happens inside Magick.  The verbosity of this log file can
vary depending on the --debug option, or the VERBOSE config option.
This file may be zeroed without any decremental effects, or if
it is removed, the OFF and ON online commands will re-establish
the filehandle. This filename is a setting in the magick.ini file,
and may be changed.  This file is created if it doesn't exist.
<P>
<DT><B>magick.pid</B><DD><P>This file indicates the process ID of the currently
running Magick on UNIX-based systems.  This may be used to easily
determine if Magick is running, and to kill a running copy. This
filename is a setting in the magick.ini file, and may be changed.
This file is overwritten on Magick startup.
<P>
<DT><B>magick.motd</B><DD><P>This contains the text of the server motd that will
be displayed to any user who types /MOTD services.server in their
IRC client. This filename is a setting in the magick.ini file, and
may be changed.
<P>
<DT><B>magick.key</B><DD><P>This contains the key for your databases, encrypted.
This key file should be generated with magick_keygen.  This file
may not be used by more than one set of services (unless the binaries
are copied), as each compile requires regenerating this file.  This
filename is a setting in the magick.ini file, and may be changed.
<P>
<DT><B>lang</B><DD><P>This directory is where all language files (*.lng, *.lfo and
*.hlp) will be stored.  The path name actually used is a setting
in the magick.ini file.
<P>
<DT><B>lang\*.lng</B><DD><P>These files contain the responses Magick will send back
to users for any command, or output from any procedure.  These files
are 'tokenised', and are substituted with actual values.  The default
language file to used is set by the DEF_LANGUAGE parameter in the
magick.ini file, however languages may be set per-user.
<P>
<DT><B>lang\*.lfo</B><DD><P>These files contain the log file outputs Magick will
use for all messages going to the magick.log file.  These files are
'tokenised', and are substituted with actual values.  The file that
is used is set by the DEF_LANGUAGE parameter in the magick.ini file.
<P>
<DT><B>lang\*.hlp</B><DD><P>These files contain the help text that Magick uses to
respond to all HELP commands.  The default help file used is set by
the DEF_LANGUAGE parameter in the magick.ini file, however languages
may be set per-user.
<P>
<DT><B>files\pic</B><DD><P>This directory is where all user's pictures are stored.
The files themselves are stored as hexadecimal numbers, with no
extension -- the map to real filenames is stored in the database.
The path name actually used is a setting in the magick.ini file.
<P>
<DT><B>files\memo</B><DD><P>This directory is where all attachments are stored.
The files themselves are stored as hexadecimal numbers, with no
extension -- the map to real filenames is stored in the database.
The path name actually used is a setting in the magick.ini file.
<P>
<DT><B>files\public</B><DD><P>This directory is where all files in the public
filesystem are stored.
The files themselves are stored as hexadecimal numbers, with no
extension -- the map to real filenames is stored in the database.
The path name actually used is a setting in the magick.ini file.
<P>
<DT><B>files\temp</B><DD><P>This directory is where all files involved in DCC
transfers (sending or receiving) are stored.  These files are
considered volatile, and if Magick is not running, can safely be
removed. The files themselves are stored as hexadecimal numbers,
with no extension. The path name actually used is a setting in the
magick.ini file.
</DL>
<P>
<H2><A NAME="ss3.2">3.2 General Usage</A>
</H2>

<P>
<P>Magick once started, becomes a background process.  It accepts
a number of command-line options that override the settings of
their equivalents on load.  NOTE: If the config file is loaded
again at runtime, the settings in the config file will be used.
<P>
<BLOCKQUOTE><CODE>
<PRE>
--help (or -?)  Help output (summary of the below).
--dir X         Set the initial services directory.
--config X      Set the name of the config file.
--convert X     Convert another version of services databases
                to Magick II format, where X is the type of
                database to convert.  Currently recognised:
                        magick (1.4)   esper (4.4.8)
                MUST BE COMPILED INTO BINARY TO BE AVAILABLE.
--trace X:Y     Set the trace level on startup, equivalent of
                using the OperServ TRACE SET command while
                running, where X is the trace type (or ALL), and
                Y is the trace level in hex.
                MUST BE COMPILED INTO BINARY TO BE AVAILABLE.
</PRE>
</CODE></BLOCKQUOTE>
<P>All other command line options just override the configuration
file settings.  Below is a list of the overrides available, and
the settings they override in the configuration file.  Please see
the configuration file's comments for more information on each
option, and what it does.
<P>
<BLOCKQUOTE><CODE>
<PRE>
PARAMATER       SHORT   GROUP           OPTION
---------       -----   -----           ------
--name X        -n      STARTUP         SERVER_NAME
--desc X        -d      STARTUP         SERVER_DESC
--user X        -u      STARTUP         SERVICES_USER
--host X        -h      STARTUP         SERVICES_HOST
--ownuser       -o      STARTUP         OWNUSER=true
--protocol X    -P      STARTUP         PROTOCOL
--level X       -l      STARTUP         LEVEL
--lagtime X     -g      STARTUP         LAGTIME
--verbose       -v      FILES           VERBOSE=true
--log X         -L      FILES           LOGFILE
--logchan X     -C      FILES           LOGCHAN
--dbase X       -D      FILES           DATABASE
--langdir X     -S      FILES           LANGDIR
--encrypt       -E      FILES           ENCRYPTION=true
--decrypt       -e      FILES           ENCRYPTION=false
--keyfile X     -K      FILES           KEYFILE
--compress X    -c      FILES           COMPRESSION
--relink X      -r      CONFIG          SERVER_RELINK
--cycle X       -t      CONFIG          CYCLETIME
--save X        -w      CONFIG          SAVETIME
--check X       -T      CONFIG          CHECKTIME
--ping X        -p      CONFIG          PING_FREQUENCY
--thread X      -X      CONFIG          MIN_THREADS
--lwm X         -m      CONFIG          LOW_WATER_MARK
--hwm X         -M      CONFIG          HIGH_WATER_MARK
--append        -a      NICKSERV        APPEND_RENAME=true
--rename        -A      NICKSERV        APPEND_RENAME=false
--ident X       -R      NICKSERV        IDENT
--language X    -s      NICKSERV        DEF_LANGUAGE
--nodcc         -x      NICKSERV        PICEXT=  (nothing)
                        MEMOSERV        FILES=0
--inflight X    -f      MEMOSERV        INFLIGHT
--logignore     -i      OPERSERV        LOG_IGNORE=true
--ignore X      -I      OPERSERV        IGNORE_METHOD
</PRE>
</CODE></BLOCKQUOTE>
<P>Example:
<P>
<BLOCKQUOTE><CODE>
<PRE>
./magick --config /etc/magick.ini
</PRE>
</CODE></BLOCKQUOTE>
<P>After Magick is running, it should be totally driven through the
on-line clients (NickServ, ChanServ, OperServ, etc).  However,
in certain cases, events happen and these interfaces are either
not available, not responding, too slow, or don't recognise you.
For this eventuality, all UNIX SIGNALS have been trapped, and
some perform extra functions that 'originally' intended.
<P>
<BLOCKQUOTE><CODE>
<PRE>
SIGNAL  NUMBER  EQUIVALENT      DESCRIPTION
------  ------  ----------      -----------
SIGHUP  1       OS RELOAD       Re-loads the config file.
SIGINT  2       OS SIGNON       Attempts to sign on all clients.
SIGPIPE 13      IGNORE          Flushes trace output immediately.
SIGTERM 15      OS UPDATE       Saves the databases.
SIGCHLD 17      IGNORE          Check to see if we're alive.
</PRE>
</CODE></BLOCKQUOTE>
<P>Some have queried me on why SIGTERM saves the databases.  During
shutdown of many systems, the shutdown scripts will send a SIGTERM
to all running processes, wait a while, then send a SIGKILL (9).
This gives us a chance to save our databases before we're killed.
This also means that you must use kill -KILL (kill -9) to kill
Magick once it has been started.
<P>To use encryption, you must generate a key file with the program
magick_keygen.  This program accepts a maximum of two arguments,
being the output key filename, and an input file with the plain
text version of the key respectively.  If neither argument is
supplied, it will ask you to enter the data interactively.
<P>On unix terminals that support it, the text entered at the key
prompts will be hidden, however to not bank on this, and always
ensure no one can look over your shoulder of sniff your network
traffic to find out what the clear-text password is.  The maximum
size of a key is specified at compile time, and may be changed
with a configure option (see INSTALL for further details).
<P>Example 1:
<P>
<BLOCKQUOTE><CODE>
<PRE>
./magick_keygen
Magick IRC Services - http://www.magick.tm
    (c) 1997-2001 Preston A. Elder &lt;prez@magick.tm&gt;
    (c) 1998-2001 William King &lt;ungod@magick.tm&gt;

Enter filename to output to [magick.key]:
Enter database key:
Re-Enter database key:

Created 362 byte keyfile.
</PRE>
</CODE></BLOCKQUOTE>
<P>Example 2:
<P>
<BLOCKQUOTE><CODE>
<PRE>
./magick_keygen magick.key magick.plain
Magick IRC Services - http://www.magick.tm
    (c) 1997-2001 Preston A. Elder &lt;prez@magick.tm&gt;
    (c) 1998-2001 William King &lt;ungod@magick.tm&gt;

Created 1024 byte keyfile.
</PRE>
</CODE></BLOCKQUOTE>
<P>Tip:  Its usually a good idea to find a random file that doesnt
change, or that you have a version of, and choose a random point
somewhere in the middle (remember the starting point), and cut
from that point on into a seperate file, then feed that as the
plain magick key, and then remove your plain key file.  This way
you will not have to remember a whole big key, just where the
key is from, and the beginning point in the file (ensure it is
a big file and dont tell anyone what file it is, where to get it
or the starting point for security.  This is usually the easiest
way to create a big key and remember it all without having to
tax your brain, or worry about forgetting it.  NEVER EVER leave
a plain key file (ie. your file with everything before the start
point truncated) lying around -- and do not use a file that may
change from version to version of wherever you got it.
<P>
<H2><A NAME="ss3.3">3.3 Functionality</A>
</H2>

<P>
<P>Magick has 6 main services, and offers the ability to script either
added functionality to these existing services, or create totally
new services through its scripting language.  This section gives an
overview of the main functionality and purpose of the hard-coded
services.  Please note, the actual nicknames of each of the below
services may be different on each network.
<P>NickServ is a services that allows users to register their IRC
nicknames so that no one else may take them.  Users may then set
various options on their nickname record, such as privacy mode,
kill protection, etc that affect the way their nickname is
treated, and how services respond to them.  They may also set
purely informational fields in their nickname record they is
displayed on an INFO request.  NickName registration is required
to execute many other commands in services, be added to a channel
access list, or receive memos from other users.
<P>ChanServ is a service that allows users to register a channel on
the IRC network, so that they may specify who has access to them,
and who shall be automatically kicked from them.  This not only
prevents such things as channel takeovers, but establishes a
definite 'seniority' system in the channel.  ChanServ also allows
users to set various options on their channel records, from the
purely informational that is displayed in an INFO request, to
options that change the behaviour of services, and how users are
treated in a channel.  This service also offers such features as
on-join greetings, user-based greetings, etc.
<P>MemoServ is a service that allows users to send memos to other
users, or post news articles to channels.  This service also
allows such features as forwarding, or replying to memos, and
even attaching files via. DCC to memos (to other users only).
This service also integrates with NickServ's ignore list, and
ChanServ's access list to vary the ability to send, or read
memos or news articles.
<P>CommServ is a service that maintains 'committees' or groups of
users.  These groups can be simply a list of users who have a
common interest, or can alter a user's access to certain features
of services.  You may also send memos to all members of a committee
or set logon messages for committees that all members will see
on signon.  Services has 6 'default' committees:
<DL>
<DT><B>SADMIN</B><DD><P>Services Administrators - Members of this
committee are hard-coded into the Magick
configuration file.
<DT><B>SOP</B><DD><P>Services Operators - Members of this committee
are added by members of the SADMIN committee.
<DT><B>ADMIN</B><DD><P>Server Administrators - Members of this committee
are added by members of the SADMIN committee.
<DT><B>OPER</B><DD><P>IRC Operators - Members of this committee are
added by members of the ADMIN committee.
<DT><B>REGD</B><DD><P>All Registered Users - This committee may not be
modified, and its members are dynamic.
<DT><B>ALL</B><DD><P>All Users - This committee may not be modified,
and its members are dynamic.
</DL>
<P>OperServ is a services that allows IRC Operators to keep control
on the network.  This service offers functions like an Automatic
Kill list, Clone Protection (and overriding), Services Ignore,
IRC Operator Denying, as well as the ability to JUPE (fake-link)
a server, change a user or channels modes, and many more functions.
<P>ServMsg is mainly an informational service, users may get help,
statistics and information about services, and the network they
are connected to from this service.  This service also offers the
ability for Server Administrators to send a global message that
will be sent to all users on the network, and services operators
to offer files to users through the public file system.
<P>
<HR>
<A HREF="index-4.html">Next</A>
<A HREF="index-2.html">Previous</A>
<A HREF="index.html#toc3">Contents</A>
</BODY>
</HTML>
